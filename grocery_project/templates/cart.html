{% extends 'base.html' %}
{% block content %}
<h2><i class="fa fa-shopping-cart"></i> Ваша корзина</h2>

{% if products %}
<table class="table align-middle mt-3">
    <thead class="table-light">
        <tr>
            <th>Товар</th>
            <th>Цена</th>
            <th>Количество</th>
            <th>Сумма</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for p in products %}
        <tr>
            <td>{{ p.name }}</td>
            <td>{{ p.price }} сом</td>
            <td>{{ p.qty }} {{ p.unit }}</td>
            <td>{{ p.subtotal }} сом</td>
            <td>
                <a href="/remove_from_cart/{{ p.id }}" class="text-danger"><i class="fa fa-trash"></i></a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div class="row mt-4 p-3 bg-white shadow-sm rounded">
    <div class="col-md-6">
        <form action="/checkout" method="POST">
            <div class="mb-3">
                <label>Кто обслуживает? (Кассир)</label>
                <select name="employee_id" class="form-select" required>
                    {% for e in employees %}<option value="{{ e.employee_id }}">{{ e.full_name }}</option>{% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label>Покупатель (если есть карта)</label>
                <select name="customer_id" class="form-select">
                    <option value="">Анонимный покупатель</option>
                    {% for c in customers %}<option value="{{ c.customer_id }}">{{ c.full_name }}</option>{% endfor %}
                </select>
            </div>
            <button type="submit" class="btn btn-success btn-lg w-100">Оформить заказ на {{ total }} сом</button>
        </form>
    </div>
</div>
{% else %}
<div class="alert alert-info mt-4">Корзина пока пуста. <a href="/">Перейти к покупкам</a></div>
{% endif %}
{% endblock %}